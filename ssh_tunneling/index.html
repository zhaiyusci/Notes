<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>打通内外网 · Yu Zhai&#39;s Notes</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Yu Zhai&#39;s Notes</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Welcome to my notes!</a></li><li><a class="tocitem" href="../cowriting_sop/">团队技术写作标准作业流程</a></li><li><a class="tocitem" href="../julia_docs/">我是如何使用 <code>Documenter.jl</code> 来搭建这个网站的</a></li><li><a class="tocitem" href="../quantum_harmonic_oscillator/">Quantum Harmonic Oscillator as a training material for young theoretical chemists</a></li><li class="is-active"><a class="tocitem" href>打通内外网</a><ul class="internal"><li><a class="tocitem" href="#临时让服务器连上外网的方法"><span>临时让服务器连上外网的方法</span></a></li><li><a class="tocitem" href="#使用-AngDesk-建立远程访问服务器终端的方法"><span>使用 AngDesk 建立远程访问服务器终端的方法</span></a></li></ul></li><li><a class="tocitem" href="../ydvr/"><code>ydvr</code> A C++ implement of DVR method</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>打通内外网</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>打通内外网</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/zhaiyusci/notes/blob/master/docs/src/ssh_tunneling.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="打通内外网"><a class="docs-heading-anchor" href="#打通内外网">打通内外网</a><a id="打通内外网-1"></a><a class="docs-heading-anchor-permalink" href="#打通内外网" title="Permalink"></a></h1><p>很多科研单位的工作服务器是放在内网的，没有互联网连接。这让工作及其痛苦。其一，你无法使用包管理器，这导致非常严重的问题，因为别人早就可以一条 <code>conda install</code> 完成任务了，你还在很辛苦地配环境。更不必说有的传统的 C++ 软件，本身就要依赖这个依赖那个，别人一条<code>apt install</code>万事大吉了，你还在折腾。还有一种情况就是机器没问题，人不在单位，连不上内网的服务器。</p><p>这些问题困扰了我们很长时间。原来很多的工作还是基于传统的编译型语言的，也就一个一个编译过去得了。最近越来越多的工作落在在 Python 和 Julia 这样的语言上，对于人家有包管理器的人，包的依赖是一个套一个一个接一个的。（写FORTRAN出身的人应该很难理解为什么转个单位也要一个包。）打通内外网的界限因此成为了必须。</p><p>这些问题解决的总开关是端口转发，port tunneling。以下分几种情况，分类介绍。</p><h2 id="临时让服务器连上外网的方法"><a class="docs-heading-anchor" href="#临时让服务器连上外网的方法">临时让服务器连上外网的方法</a><a id="临时让服务器连上外网的方法-1"></a><a class="docs-heading-anchor-permalink" href="#临时让服务器连上外网的方法" title="Permalink"></a></h2><p>这需要让计算服务器的所有对外的流量通过代理。</p><p>首先在桌面端搭建代理服务器，具体地，安装<a href="https://squid.diladele.com/">Squid for Windows</a>。这个软件可以把你的桌面（Windows 系统电脑）变成一个代理服务器。安装好以后，运行，在系统右下角托盘找到它的章鱼图标，右击编辑配置文件。在 Squid 配置文件末尾加入 <code>http_access allow all</code> 并重启Squid。Squid 默认监听端口是3128，需要改的话请自便（但是其实没有修改的必要）。</p><p>当然搭建代理服务器的方式不是只有这一种，Squid 只是单纯的把计算服务器对外的流量通过自己的桌面正常发送出去。同理你可以把这个流量通过别的信道发到别的什么地方去，例如软件经销商的升级服务器网络。</p><p>而在计算服务器上，你需要做这些。首先，请系统管理员用root权限修改 <code>/etc/ssh/sshd_config</code> ，其中 <code>GatewayPorts</code> 应为 <code>yes</code> 。如有必要重启sshd。这件事只需要做一次，所以你可以先跳过这这步，说不定管理员已经修改过了。</p><p>然后在你自己的<code>.bashrc</code>里面添加</p><pre><code class="language-bash hljs">export http_proxy=127.0.0.1:3129
export https_proxy=127.0.0.1:3129</code></pre><p>这里选定了服务器端的3129端口为代理。注意和下面的远程端口转发对照。</p><p>接下来，打开桌面的终端。输入</p><pre><code class="language-bash hljs">ssh -R 3129:localhost:3128 user@server_address</code></pre><p>这样可以正常登入服务器，而且建立了服务器端的3129端口到桌面的3128的通道。你当然需要自己修改你的 <code>user</code> 和 <code>server_address</code>。</p><p>如果一切顺利的话，你可以测试，在服务器端输入</p><pre><code class="language-bash hljs">curl -O https://www.zhaiysci.net/index.html</code></pre><p>可以成功我网站的首页，那就证明设置成功了。你应该就可以正常使用<code>conda</code>之类的包管理器。</p><h2 id="使用-AngDesk-建立远程访问服务器终端的方法"><a class="docs-heading-anchor" href="#使用-AngDesk-建立远程访问服务器终端的方法">使用 AngDesk 建立远程访问服务器终端的方法</a><a id="使用-AngDesk-建立远程访问服务器终端的方法-1"></a><a class="docs-heading-anchor-permalink" href="#使用-AngDesk-建立远程访问服务器终端的方法" title="Permalink"></a></h2><p>这个问题我做过<a href="https://www.bilibili.com/video/BV1tu411v7eX">一个视频</a>，可以看看。</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../quantum_harmonic_oscillator/">« Quantum Harmonic Oscillator as a training material for young theoretical chemists</a><a class="docs-footer-nextpage" href="../ydvr/"><code>ydvr</code> A C++ implement of DVR method »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.17 on <span class="colophon-date" title="Monday 9 May 2022 19:57">Monday 9 May 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
